@model dynamic
    <div class="ts-main-content">
        <div>
            @Html.Partial("Header")
        </div>
        <div>
            @Html.Partial("HostelClerk_Sidebar")
        </div>
        <div class="content-wrapper">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">

                        <h2 class="page-title" style="margin-top:5%">Add New Allottment </h2>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="panel panel-primary">

                                    <div class="panel-heading">Fill All Info</div>
                                    <div class="panel-body">

                                        <form method="post" action="/HostelClerk/student_info" class="form-horizontal" enctype="multipart/form-data">

                                            <div class="form-group">
                                                <h3 class="col-sm-2 control-label" style="color: green">Personal Info:</h3>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Name :</label>
                                                <div class="col-sm-4">
                                                    <input type="text" name="name" id="name" class="form-control" required pattern="[A-Z][a-z]* [a-z]*" title=" Only Alphabets (Starting with Capital Letters)">
                                                </div>
                                                <div class="col-sm-4">
                                                    <input type="file" name="ImageData" id="ImageData" onchange="fileCheck(this)" required />
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">CNIC (without dashes 13 Digits) : </label>
                                                <div class="col-sm-8">
                                                    <input type="text" name="cnic" id="cnic" class="form-control" pattern="[0-9]{13}" title="13 Digits" required>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Father's name: </label>
                                                <div class="col-sm-8">
                                                    <input type="text" name="fname" id="fname" class="form-control" pattern="[A-Z][a-z]* [a-z]*" title=" Only Alphabets (Starting with Capital Letters)" required>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Parent/Guardian's Occupation: </label>
                                                <div class="col-sm-8">
                                                    <input type="text" name="occupation" id="occupation" class="form-control" pattern="\D*" title=" Only Alphabets" required>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Monthly Income: </label>
                                                <div class="col-sm-8">
                                                    <input type="text" name="income" id="income" class="form-control" pattern="[0-9]*" title="Only Digits" required>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Present Home Address: </label>
                                                <div class="col-sm-8">
                                                    <textarea rows="5" name="paddress" id="paddress" class="form-control" required="required"></textarea>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Permanent Home Address: </label>
                                                <div class="col-sm-8">
                                                    <textarea rows="5" name="permanentaddress" id="permanentaddress" class="form-control" required="required"></textarea>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">District: </label>
                                                <div class="col-sm-8">
                                                    <input type="text" name="district" id="district" class="form-control" pattern="[A-Z][a-z]* [a-z]*" title="Alphabets only" required="required">
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Cell Number (Student without dashes): </label>
                                                <div class="col-sm-8">
                                                    <input type="text" name="stu_num" id="stu_num" class="form-control" pattern="[0-9]{11}" title="11 Digits" required="required">
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Cell Number (Guardian without dashes): </label>
                                                <div class="col-sm-8">
                                                    <input type="text" name="grd_num" id="grd_num" class="form-control" pattern="[0-9]{11}" title="11 Digits" required="required">
                                                </div>
                                            </div>
                                            <div class="form-group" id="education">
                                                <label class="col-sm-2 control-label">Education: </label>
                                                <div class="add-edu">
                                                    <div class="col-sm-8">
                                                        <div class="col-sm-4">
                                                            <input type="text" name="edu_name0" pattern="[A-Z][a-z]* [a-z]*" title="Alphabets only (Starting with capital letters)" id="edu_name" class="form-control" placeholder="Degree" required />
                                                        </div>
                                                        <div class="col-sm-4">
                                                            <input type="text" name="marks_obt0"  id="marks_obt" class="form-control" pattern="[0-9]" title="Only Digits" placeholder="Marks Obt" required>
                                                        </div>
                                                        <div class="col-sm-4">
                                                            <input type="text" name="total_marks0" id="total_marks" class="form-control" pattern="[0-9]" title="Only Digits" placeholder="Total Marks" required>
                                                        </div>
                                                        <div class="col-sm-8">
                                                            <input type="text" pattern="[A-Z][a-z]* [a-z]*" title="Alphabets only (Starting with capital letters)" name="board0" id="board" class="form-control " placeholder="Board/Uni" required />
                                                        </div>
                                                        <div class="col-sm-4">
                                                            <input type="number" min="1980" max="2030" value="2010" name="session0" id="Session" class="form-control" placeholder="Session" required />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="add" onclick="add()">
                                                    <i class="fa fa-plus" style="font-size:15px"></i>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <input type="hidden" name="education_no" value="1" />
                                                <label class="col-sm-2 control-label">Blood Group </label>
                                                <div class="col-sm-8">
                                                    <select name="bloodGroup" class="form-control" required="required">
                                                        <option value="">Select Blood Group</option>
                                                        <option value="A+">A+</option>
                                                        <option value="A-">A-</option>
                                                        <option value="B+">B+</option>
                                                        <option value="B-">B-</option>
                                                        <option value="O+">O+</option>
                                                        <option value="O-">O-</option>
                                                        <option value="AB+">AB+</option>
                                                        <option value="AB-">AB-</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Hepatits Report (HBSAg): </label>
                                                <div class="col-sm-8">
                                                    <select name="hbsag" class="form-control" required="required">
                                                        <option value="">Select</option>
                                                        <option value="Positive">Positive</option>
                                                        <option value="Negative">Negative</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Hepatits Report (Anti HCV): </label>
                                                <div class="col-sm-8">
                                                    <select name="hcv" class="form-control" required="required">
                                                        <option value="">Select</option>
                                                        <option value="Positive">Positive</option>
                                                        <option value="Negative">Negative</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Nationality: </label>
                                                <div class="col-sm-8">
                                                    <input type="text" name="nationality" id="nationality" pattern="[A-Z][a-z]*" title="Alphabets only (Starting with capital letters)" class="form-control" required="required">
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Institute/Department : </label>
                                                <div class="col-sm-8">
                                                    <select type="text" name="dep_name" id="dep_name" class="form-control" required>
                                                        <option value="">Select Department</option>
                                                        @foreach (var s in Model.b)
                                                        {
                                                            <option value="@s.dep_id">@s.dep_name</option>
                                                        }
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Degree in which Admitted: </label>
                                                <div class="col-sm-8">
                                                    <input type="text" name="class" id="class" pattern="[A-Z][a-z]* [a-z]*" title="Alphabets only (Starting with capital letters)" class="form-control" required="required">
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Roll Number: </label>
                                                <div class="col-sm-8">
                                                    <input type="text" name="roll_no" id="roll_no" class="form-control" required="required">
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Session Start: </label>
                                                <div class="col-sm-8">
                                                    <input type="month" name="session_start" class="form-control" required="required">
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Session End: </label>
                                                <div class="col-sm-8">
                                                    <input type="month" name="session_end" class="form-control" required="required">
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Batch: </label>
                                                <div class="col-sm-8">
                                                    <input type="number" min="1900" max="2099" step="1" value="2020" name="session" id="Session" class="form-control" placeholder="Session" required="required">
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <h3 class="col-sm-2 control-label" style="color: green"> Room Allotment: </h3>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Room Number</label>
                                                <div class="col-sm-8">
                                                    <select name="room_number" class="form-control" required="required">
                                                        <option value="">Select Room Number</option>
                                                        @foreach (var s in Model.a)
                                                        {
                                                            <option value="@s.room_id">@s.room_no (@s.room_type)</option>
                                                        }
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <h3 class="col-sm-2 control-label" style="color: green">Login Info:</h3>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Username:</label>
                                                <div class="col-sm-8">
                                                    <input type="text" name="stud_username" class="form-control" pattern="[A-Za-z0-9_]{1,20}" title="No more than 20 Characters (alphabets,Digits, '_')" required />
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Password</label>
                                                <div class="col-sm-8">
                                                    <input type="password" name="stud_passwd" class="form-control" pattern=".{6,}" title="More than 6 characters" required>
                                                </div>
                                            </div>
                                            <div class="col-sm-6 col-sm-offset-4">
                                                <input type="submit" name="submit" id="add_allottment" value="ADD" class="btn btn-primary">
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
    <script>
        var userExists = false;
        $('input[name=stud_username]').blur(function (e) {
            $.ajax({
                url: "/Home/checkUser?username=" + $('input[name=stud_username]').val(),
                type: "GET",
                success: function (data) {
                    if (data.user_available) {
                        window.alert("Username already existing!")
                        userExists = true;
                    } else {
                        userExists = false;
                    }
                }
            });
        });
        var isRoomAvaialable = true;
        $('select[name=room_number]').blur(function (e) {
            $.ajax({
                url: "/Home/checkRoom?num=" + $('select[name=room_number]').val(),
                type: "GET",
                success: function (data) {
                    if (!data.room_available) {
                        window.alert("Room is filled already!")
                        isRoomAvaialable = false;
                    } else {
                        isRoomAvaialable = true;
                    }
                }
            });
        });
        $("form").submit(function (e) {
            if (userExists) {
                alert("Username already existing!")
            }
            else if (!isRoomAvaialable) {
                window.alert("Room is filled already!")
            }
            return isRoomAvaialable && !userExists;
        })
        var key = 0;
        function add() {
            key += 1;
            $('input[name="education_no"]').val(key);
            console.log(key);
            var inputs = [];
            var html = `<div class="form-group"
                <div class = "add-edu">
                <div class="col-sm-8 col-sm-offset-2" style="margin-top:10px">
                <div class="col-sm-4">
                <input type="text" name="edu_name${key}" id="edu_name${key}" class="form-control" placeholder="Degree" required>
                </div>
                <div class="col-sm-4">
                <input type="text" name="marks_obt${key}" id="marks_obt${key}" class="form-control " placeholder="Marks Obt" required="required">
                </div>
                <div class="col-sm-4">
                <input type="text" name="total_marks${key}" id="total_marks${key}" class="form-control" placeholder="Total Marks" required="required">
                </div>
                <div class="col-sm-8">
                <input type="text" name="board${key}" id="board${key}" class="form-control " placeholder="Board/Uni" required="required">
                </div>
                <div class="col-sm-4">
                <input type="number" min="1980" max="2030" value = "2010" name="session${key}" id="Session${key}" class="form-control" placeholder="Session" required="required">
                </div>
                </div>
                </div>
                </div>`
            $("#education").append(html);
        }
    </script>

